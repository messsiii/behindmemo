# Behind Memory - AI Love Letter Generator

Behind Memory æ˜¯ä¸€ä¸ªåŸºäº AI çš„æƒ…ä¹¦ç”Ÿæˆå™¨ï¼Œå¸®åŠ©ç”¨æˆ·é€šè¿‡ç…§ç‰‡å’Œæ•…äº‹åˆ›ä½œä¸ªæ€§åŒ–çš„æƒ…ä¹¦ã€‚

## æŠ€æœ¯æ ˆ

- **å‰ç«¯æ¡†æ¶**: Next.js 15 (App Router)
- **æ ·å¼**: Tailwind CSS + Shadcn/ui
- **æ•°æ®åº“**: PostgreSQL (Neon)
- **ç¼“å­˜**: Upstash Redis
- **è®¤è¯**: NextAuth.js
- **AI**: MiniMax / Gemini / GPT-4
- **å­˜å‚¨**: Cloudflare R2 (å›¾ç‰‡ã€éŸ³é¢‘ã€åª’ä½“æ–‡ä»¶)
- **éƒ¨ç½²**: Vercel

## æ ¸å¿ƒåŠŸèƒ½

- ğŸ“¸ ç…§ç‰‡ä¸Šä¼ ä¸åˆ†æ
  - EXIF æ•°æ®æå–ï¼ˆæ‹æ‘„æ—¶é—´ã€åœ°ç†ä½ç½®ï¼‰
  - æ™ºèƒ½ç…§ç‰‡åˆ†æå’Œåœºæ™¯ç†è§£
  - è‡ªåŠ¨å›¾ç‰‡ä¼˜åŒ–å’Œå‹ç¼©
- âœï¸ AI è¾…åŠ©æƒ…ä¹¦ç”Ÿæˆ
  - åŸºäºç…§ç‰‡åœºæ™¯çš„æƒ…æ„Ÿåˆ†æ
  - å¤šè½®å¯¹è¯å¼å†™ä½œæŒ‡å¯¼
  - ä¸ªæ€§åŒ–æ–‡é£è°ƒæ•´
- ğŸ¨ ç²¾ç¾çš„ä¿¡ä»¶å±•ç¤º
  - å“åº”å¼å¸ƒå±€è®¾è®¡
  - ç…§ç‰‡ä¿¡ä»¶ä¸€ä½“åŒ–å±•ç¤º
  - æ”¯æŒå¯¼å‡ºé«˜æ¸…å›¾ç‰‡
- ğŸŒ å¤šè¯­è¨€æ”¯æŒ (ä¸­/è‹±)
  - ç•Œé¢å®Œæ•´åŒè¯­æ”¯æŒ
  - AI ç”Ÿæˆå†…å®¹åŒè¯­åˆ‡æ¢
  - åœ°ç†ä¿¡æ¯æœ¬åœ°åŒ–æ˜¾ç¤º
- ğŸ‘¤ ç”¨æˆ·è®¤è¯ä¸æˆæƒ
  - Google OAuth ç™»å½•
  - é‚®ç®±éªŒè¯ç™»å½•
  - ç”¨æˆ·æ•°æ®å®‰å…¨å­˜å‚¨
- ğŸ’« ç§¯åˆ†ç³»ç»Ÿ
  - æ–°ç”¨æˆ·æ³¨å†Œå¥–åŠ±
  - ä½¿ç”¨æ¬¡æ•°é™åˆ¶
  - ä¼šå‘˜ç‰¹æƒç®¡ç†

## æœ€æ–°åŠŸèƒ½

- ğŸ”„ ä¿¡ä»¶å¤ç”¨åŠŸèƒ½
  - æ”¯æŒå¤ç”¨å½“å‰ä¿¡ä»¶ä¿¡æ¯
  - æ™ºèƒ½é¢„å¡«å†™è¡¨å•
  - ä¼˜åŒ–å†™ä½œæµç¨‹
- ğŸ“ åœ°ç†ä¿¡æ¯å¢å¼º
  - æ™ºèƒ½æå–ç…§ç‰‡åœ°ç†ä¿¡æ¯
  - å¤šè¯­è¨€åœ°å€æ˜¾ç¤º
  - åœ°ç†åœºæ™¯èå…¥ç”Ÿæˆ
- ğŸ¯ æ‹æ‘„æ—¶é—´ä¼˜åŒ–
  - å‡†ç¡®æå–åŸå§‹æ‹æ‘„æ—¶é—´
  - æ—¶é—´ä¿¡æ¯æ™ºèƒ½èå…¥å†…å®¹
  - é¿å…æ—¶é—´ä¿¡æ¯ç¼ºå¤±
- ğŸ–¼ï¸ å¯¼å‡ºåŠŸèƒ½ä¼˜åŒ–
  - æ”¯æŒé«˜æ¸…å›¾ç‰‡å¯¼å‡º
  - è‡ªå®šä¹‰å¯¼å‡ºæ ·å¼
  - å›¾æ–‡å¸ƒå±€ä¼˜åŒ–
- ğŸŒ AIå›¾ç‰‡ç”Ÿæˆç¿»è¯‘åŠŸèƒ½
  - è‡ªåŠ¨æ£€æµ‹è¾“å…¥æç¤ºè¯è¯­è¨€
  - éè‹±è¯­è‡ªåŠ¨ç¿»è¯‘ä¸ºè‹±è¯­
  - ä¼˜åŒ–å›¾ç‰‡ç”Ÿæˆæ•ˆæœ
  - æ”¯æŒå¤šè¯­è¨€æ™ºèƒ½è¯†åˆ«
  - ç¿»è¯‘çŠ¶æ€å®æ—¶æ˜¾ç¤º

## ç§¯åˆ†ç³»ç»Ÿ

- æ–°ç”¨æˆ·æ³¨å†Œè·å¾— 30 ç‚¹åˆå§‹ç‚¹æ•°
- æ¯æ¬¡ç”Ÿæˆæ¶ˆè€— 10 ç‚¹
- VIP ç”¨æˆ·åŒæ ·éœ€è¦æ¶ˆè€—ç‚¹æ•°
- å¯é€šè¿‡è®¢é˜…æˆ–è´­ä¹°ç‚¹æ•°åŒ…è·å–æ›´å¤šç‚¹æ•°

## æ•°æ®æ¨¡å‹

### User ç”¨æˆ·æ¨¡å‹

```typescript
{
  id: string            // ç”¨æˆ·å”¯ä¸€æ ‡è¯†ç¬¦
  name: string?        // ç”¨æˆ·åç§°
  email: string?       // é‚®ç®±åœ°å€ï¼ˆå”¯ä¸€ï¼‰
  emailVerified: Date? // é‚®ç®±éªŒè¯æ—¶é—´
  image: string?       // ç”¨æˆ·å¤´åƒ URL
  totalUsage: number   // æ€»ä½¿ç”¨æ¬¡æ•°
  lastLoginAt: Date    // æœ€åç™»å½•æ—¶é—´
  createdAt: Date      // åˆ›å»ºæ—¶é—´
  updatedAt: Date      // æ›´æ–°æ—¶é—´
  isVIP: boolean       // æ˜¯å¦æ˜¯ VIP
  vipExpiresAt: Date?  // VIP è¿‡æœŸæ—¶é—´
  credits: number      // å‰©ä½™ç‚¹æ•°
  paddleCustomerId: string?       // Paddleå®¢æˆ·ID
  paddleSubscriptionId: string?   // Paddleè®¢é˜…ID
  paddleSubscriptionStatus: string? // è®¢é˜…çŠ¶æ€
  accounts: Account[]  // å…³è”çš„ç¬¬ä¸‰æ–¹è´¦å·
  sessions: Session[]  // ç”¨æˆ·ä¼šè¯è®°å½•
  letters: Letter[]    // ç”¨æˆ·ç”Ÿæˆçš„ä¿¡ä»¶
  subscriptions: Subscription[] // è®¢é˜…è®°å½•
  transactions: Transaction[]   // äº¤æ˜“è®°å½•
  templateUnlocks: TemplateUnlock[] // æ¨¡æ¿è§£é”è®°å½•
}
```

### Letter ä¿¡ä»¶æ¨¡å‹

```typescript
{
  id: string          // ä¿¡ä»¶å”¯ä¸€æ ‡è¯†ç¬¦
  createdAt: Date     // åˆ›å»ºæ—¶é—´
  updatedAt: Date     // æ›´æ–°æ—¶é—´
  content: string     // ä¿¡ä»¶å†…å®¹
  imageUrl: string?   // å…³è”å›¾ç‰‡ URL
  userId: string      // åˆ›å»ºç”¨æˆ·çš„ ID
  prompt: string      // ç”¨äºç”Ÿæˆçš„æç¤ºè¯
  isPublic: boolean   // æ˜¯å¦å…¬å¼€
  likeCount: number   // ç‚¹èµæ•°
  shareCount: number  // åˆ†äº«æ•°
  language: string    // ç”Ÿæˆè¯­è¨€(zh/en)
  status: string      // ç”ŸæˆçŠ¶æ€(pending/generating/completed/failed)
  error: string?      // é”™è¯¯ä¿¡æ¯
  metadata: {         // å…ƒæ•°æ®
    name: string      // å†™ä¿¡äººåå­—
    loverName: string // æ”¶ä¿¡äººåå­—
    story: string     // æ•…äº‹èƒŒæ™¯
    location: string? // åœ°ç†ä½ç½®
    time: string?     // æ‹æ‘„æ—¶é—´
    orientation: number? // å›¾ç‰‡æ–¹å‘
  }
}
```

### Subscription è®¢é˜…æ¨¡å‹

```typescript
{
  id: string               // è®¢é˜…å”¯ä¸€æ ‡è¯†ç¬¦
  userId: string           // å…³è”çš„ç”¨æˆ· ID
  paddleSubscriptionId: string // Paddleè®¢é˜…ID
  status: string          // è®¢é˜…çŠ¶æ€
  planType: string        // è®¡åˆ’ç±»å‹
  priceId: string         // ä»·æ ¼ID
  startedAt: Date         // å¼€å§‹æ—¶é—´
  nextBillingAt: Date?    // ä¸‹æ¬¡è®¡è´¹æ—¶é—´
  canceledAt: Date?       // å–æ¶ˆæ—¶é—´
  endedAt: Date?          // ç»“æŸæ—¶é—´
  createdAt: Date         // åˆ›å»ºæ—¶é—´
  updatedAt: Date         // æ›´æ–°æ—¶é—´
  metadata: object?       // å…ƒæ•°æ®
}
```

### Transaction äº¤æ˜“æ¨¡å‹

```typescript
{
  id: string               // äº¤æ˜“å”¯ä¸€æ ‡è¯†ç¬¦
  createdAt: Date          // åˆ›å»ºæ—¶é—´
  updatedAt: Date          // æ›´æ–°æ—¶é—´
  userId: string           // å…³è”çš„ç”¨æˆ· ID
  amount: number           // äº¤æ˜“é‡‘é¢
  currency: string         // è´§å¸ (é»˜è®¤USD)
  status: string           // äº¤æ˜“çŠ¶æ€
  type: string             // äº¤æ˜“ç±»å‹
  paddleOrderId: string?   // Paddleè®¢å•ID
  paddleSubscriptionId: string? // Paddleè®¢é˜…ID
  pointsAdded: number?     // æ·»åŠ çš„ç‚¹æ•°
}
```

### TemplateUnlock æ¨¡æ¿è§£é”æ¨¡å‹

```typescript
{
  id: string // å”¯ä¸€æ ‡è¯†ç¬¦
  userId: string // å…³è”çš„ç”¨æˆ· ID
  letterId: string // å…³è”çš„ä¿¡ä»¶ ID
  templateId: string // æ¨¡æ¿ID
  createdAt: Date // åˆ›å»ºæ—¶é—´
  updatedAt: Date // æ›´æ–°æ—¶é—´
}
```

### Account è´¦å·æ¨¡å‹ï¼ˆOAuthï¼‰

```typescript
{
  id: string               // è´¦å·å”¯ä¸€æ ‡è¯†ç¬¦
  userId: string           // å…³è”çš„ç”¨æˆ· ID
  type: string            // è´¦å·ç±»å‹
  provider: string        // æä¾›å•†ï¼ˆå¦‚ Googleï¼‰
  providerAccountId: string // æä¾›å•†çš„è´¦å· ID
  refresh_token: string?   // åˆ·æ–°ä»¤ç‰Œ
  access_token: string?    // è®¿é—®ä»¤ç‰Œ
  expires_at: number?      // ä»¤ç‰Œè¿‡æœŸæ—¶é—´
  token_type: string?     // ä»¤ç‰Œç±»å‹
  scope: string?          // æƒé™èŒƒå›´
  id_token: string?       // ID ä»¤ç‰Œ
  session_state: string?  // ä¼šè¯çŠ¶æ€
}
```

### Session ä¼šè¯æ¨¡å‹

```typescript
{
  id: string // ä¼šè¯å”¯ä¸€æ ‡è¯†ç¬¦
  sessionToken: string // ä¼šè¯ä»¤ç‰Œï¼ˆå”¯ä¸€ï¼‰
  userId: string // å…³è”çš„ç”¨æˆ· ID
  expires: Date // è¿‡æœŸæ—¶é—´
}
```

### VerificationToken éªŒè¯ä»¤ç‰Œæ¨¡å‹

```typescript
{
  identifier: string // æ ‡è¯†ç¬¦
  token: string // éªŒè¯ä»¤ç‰Œï¼ˆå”¯ä¸€ï¼‰
  expires: Date // è¿‡æœŸæ—¶é—´
}
```

### WebhookEvent Webhookäº‹ä»¶æ¨¡å‹

```typescript
{
  id: string // å”¯ä¸€æ ‡è¯†ç¬¦
  paddleEventId: string // Paddleäº‹ä»¶ID
  eventType: string // äº‹ä»¶ç±»å‹
  eventData: object // äº‹ä»¶æ•°æ®
  processedAt: Date // å¤„ç†æ—¶é—´
    ? status
    : string // çŠ¶æ€
  error: string // é”™è¯¯ä¿¡æ¯
    ? createdAt
    : Date // åˆ›å»ºæ—¶é—´
}
```

### Price ä»·æ ¼æ¨¡å‹

```typescript
{
  id: string          // ä»·æ ¼ID
  type: string        // ç±»å‹
  name: string        // åç§°
  description: string? // æè¿°
  unitAmount: string   // å•ä»·é‡‘é¢
  currency: string     // è´§å¸
  interval: string?    // å‘¨æœŸ
  creditAmount: number? // ç‚¹æ•°æ•°é‡
  isActive: boolean    // æ˜¯å¦æ¿€æ´»
  createdAt: Date      // åˆ›å»ºæ—¶é—´
  updatedAt: Date      // æ›´æ–°æ—¶é—´
  metadata: object?    // å…ƒæ•°æ®
}
```

### AnonymousRequest åŒ¿åè¯·æ±‚æ¨¡å‹

```typescript
{
  id: string         // å”¯ä¸€æ ‡è¯†ç¬¦
  ipAddress: string  // IPåœ°å€
  requestType: string // è¯·æ±‚ç±»å‹
  createdAt: Date    // åˆ›å»ºæ—¶é—´
  metadata: object?  // å…ƒæ•°æ®
}
```

## ç¯å¢ƒå˜é‡

```env
# æ•°æ®åº“
DATABASE_URL=
POSTGRES_URL=
POSTGRES_PRISMA_URL=
POSTGRES_URL_NON_POOLING=
POSTGRES_URL_NO_SSL=

# è®¤è¯
NEXTAUTH_SECRET=
NEXTAUTH_URL=
GOOGLE_CLIENT_ID=
GOOGLE_CLIENT_SECRET=

# å­˜å‚¨
BLOB_READ_WRITE_TOKEN=

# ç¼“å­˜
KV_URL=
KV_REST_API_URL=
KV_REST_API_TOKEN=
KV_REST_API_READ_ONLY_TOKEN=

# AI
MINIMAX_API_KEY=

# åœ°å›¾æœåŠ¡
NEXT_PUBLIC_GOOGLE_MAPS_KEY=

# ç¿»è¯‘æœåŠ¡
GOOGLE_TRANSLATE_API_KEY=

# Paddleæ”¯ä»˜
PADDLE_WEBHOOK_SECRET=
NEXT_PUBLIC_PADDLE_CLIENT_TOKEN=
NEXT_PUBLIC_PADDLE_MONTHLY_PRICE_ID=
NEXT_PUBLIC_PADDLE_CREDITS_10_PRICE_ID=
NEXT_PUBLIC_PADDLE_CREDITS_100_PRICE_ID=
NEXT_PUBLIC_PADDLE_CREDITS_500_PRICE_ID=
NEXT_PUBLIC_PADDLE_CREDITS_1000_PRICE_ID=
```

## å¼€å‘æŒ‡å—

1. å…‹éš†é¡¹ç›®

```bash
git clone https://github.com/messsiii/behindmemo.git
cd behindmemo
```

2. å®‰è£…ä¾èµ–

```bash
npm install
```

3. é…ç½®ç¯å¢ƒå˜é‡

```bash
cp .env.example .env.local
# ç¼–è¾‘ .env.local å¡«å…¥å¿…è¦çš„ç¯å¢ƒå˜é‡
```

4. è¿è¡Œå¼€å‘æœåŠ¡å™¨

```bash
npm run dev
```

5. å¼€å‘æ³¨æ„äº‹é¡¹

- ä½¿ç”¨ `npm run lint` æ£€æŸ¥ä»£ç è§„èŒƒ
- ä½¿ç”¨ `npm run test` è¿è¡Œæµ‹è¯•
- ä½¿ç”¨ `npm run build` æ„å»ºç”Ÿäº§ç‰ˆæœ¬
- éµå¾ª [Conventional Commits](https://www.conventionalcommits.org/) è§„èŒƒæäº¤ä»£ç 

## éƒ¨ç½²

é¡¹ç›®é…ç½®ä¸ºä½¿ç”¨ Vercel è¿›è¡Œéƒ¨ç½²ï¼š

1. Fork æœ¬ä»“åº“
2. åœ¨ Vercel ä¸­å¯¼å…¥é¡¹ç›®
3. é…ç½®ç¯å¢ƒå˜é‡
   - æ•°æ®åº“è¿æ¥ä¿¡æ¯
   - è®¤è¯ç›¸å…³å¯†é’¥
   - AI API å¯†é’¥
   - å­˜å‚¨æœåŠ¡é…ç½®
   - ç¼“å­˜æœåŠ¡é…ç½®
4. éƒ¨ç½²é¡¹ç›®
5. é…ç½®åŸŸåï¼ˆå¯é€‰ï¼‰

## æ€§èƒ½ä¼˜åŒ–

- âš¡ï¸ ä½¿ç”¨ Turbopack åŠ é€Ÿå¼€å‘
- ğŸ–¼ï¸ è‡ªåŠ¨å›¾ç‰‡ä¼˜åŒ–
  - WebP æ ¼å¼è½¬æ¢
  - å“åº”å¼å›¾ç‰‡åŠ è½½
  - æ‡’åŠ è½½ä¼˜åŒ–
- ğŸ”„ æµå¼å“åº”å¤„ç†
  - AI ç”Ÿæˆæµå¼è¿”å›
  - å®æ—¶è¿›åº¦å±•ç¤º
- ğŸŒ å…¨çƒåŒ–éƒ¨ç½²æ”¯æŒ
  - å¤šåŒºåŸŸéƒ¨ç½²
  - CDN åŠ é€Ÿ
- ğŸ”’ å®‰å…¨ç‰¹æ€§
  - CSRF é˜²æŠ¤
  - XSS é˜²æŠ¤
  - è¯·æ±‚é™æµ
  - æ•°æ®åŠ å¯†

## å¾…ä¼˜åŒ–é¡¹

### 1. æ€§èƒ½ä¼˜åŒ–

1. æµå¼ç”Ÿæˆä¼˜åŒ–

   - å®ç° SSE (Server-Sent Events)
   - åˆ†å—è¿”å›ç”Ÿæˆçš„å†…å®¹
   - å‰ç«¯å®æ—¶æ˜¾ç¤ºç”Ÿæˆè¿›åº¦
   - ä¼˜åŒ–è¶…æ—¶å¤„ç†æœºåˆ¶

2. æ•°æ®åº“æ€§èƒ½ä¼˜åŒ–

   - å‡å°‘ä¸å¿…è¦çš„æ•°æ®åº“æŸ¥è¯¢
   - ä¼˜åŒ– Prisma æŸ¥è¯¢æ€§èƒ½
   - ä½¿ç”¨ç¼“å­˜å‡å°‘é‡å¤æ“ä½œ
   - å®ç°æ•°æ®åº“è¿æ¥æ± 

3. API æ€§èƒ½ä¼˜åŒ–
   - å®ç°è¯·æ±‚é˜Ÿåˆ—
   - æ·»åŠ è¯·æ±‚é™æµ
   - ä¼˜åŒ–é”™è¯¯å¤„ç†
   - å®ç°æ–­ç‚¹ç»­ä¼ 

### 2. æ¶æ„ä¼˜åŒ–

1. æœåŠ¡å™¨é™åˆ¶é€‚é…

   - é€‚é… Vercel Hobby è®¡åˆ’é™åˆ¶
   - å®ç°ä»»åŠ¡é˜Ÿåˆ—å¤„ç†
   - æ·»åŠ ä»»åŠ¡çŠ¶æ€ç®¡ç†
   - å®ç°å¤±è´¥é‡è¯•æœºåˆ¶

2. å¯æ‰©å±•æ€§ä¼˜åŒ–
   - å®ç°å¾®æœåŠ¡æ¶æ„
   - æ·»åŠ è´Ÿè½½å‡è¡¡
   - ä¼˜åŒ–èµ„æºåˆ©ç”¨
   - å®ç°æœåŠ¡é™çº§

## è´¡çŒ®æŒ‡å—

1. Fork æœ¬ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ”¹åŠ¨ (`git commit -m 'feat: add some feature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. å¼€å¯ Pull Request

## è®¸å¯è¯

[MIT License](LICENSE)

## åŠŸèƒ½ç‰¹ç‚¹

- ğŸ“ AI é©±åŠ¨çš„æƒ…ä¹¦ç”Ÿæˆ
- ğŸŒ ä¸­è‹±åŒè¯­æ”¯æŒ
- ğŸ“¸ ç…§ç‰‡ä¸Šä¼ ä¸ä¼˜åŒ–
- ğŸ” Google OAuth ç™»å½•
- ğŸ“Š ç”¨æˆ·é…é¢ç®¡ç†
- ğŸ“ ä½ç½®ä¿¡æ¯æå–
- ğŸ¨ ä¼˜é›…çš„å“åº”å¼ç•Œé¢
- âœ¨ æµç•…çš„åŠ¨ç”»æ•ˆæœ
- ğŸš€ Turbopack æ”¯æŒ

## é¡µé¢ç»“æ„

### ä¸»é¡µ (app/page.tsx)

- å“åº”å¼è‹±é›„åŒºè®¾è®¡
- ç‰¹æ€§å±•ç¤ºåŒº
- åŠ¨æ€å¯¼èˆªæ 
- å¤šè¯­è¨€åˆ‡æ¢
- ç™»å½•çŠ¶æ€ç®¡ç†

### å†™ä½œé¡µé¢ (app/write/page.tsx)

- ç…§ç‰‡ä¸Šä¼ ç»„ä»¶
- è¡¨å•éªŒè¯
- å®æ—¶é¢„è§ˆ
- è¿›åº¦å±•ç¤º
- é”™è¯¯å¤„ç†

### ç»“æœé¡µé¢ (app/result/page.tsx)

- ä¿¡ä»¶å±•ç¤º
- å¯¼å‡ºåŠŸèƒ½
- åˆ†äº«åŠŸèƒ½
- å¤ç”¨é€‰é¡¹
- è¿”å›é¦–é¡µ

### å†å²è®°å½• (app/history/page.tsx)

- ä¿¡ä»¶åˆ—è¡¨
- åˆ†é¡µåŠŸèƒ½
- ç­›é€‰åŠŸèƒ½
- åˆ é™¤åŠŸèƒ½
- ç¼–è¾‘åŠŸèƒ½

## è”ç³»æˆ‘ä»¬

- å®˜æ–¹ç½‘ç«™ï¼š[behindmemory.com](https://behindmemory.com)
- é‚®ç®±ï¼šsupport@behindmemory.com
- Twitterï¼š[@behindmemory](https://twitter.com/behindmemory)
- GitHubï¼š[messsiii/behindmemo](https://github.com/messsiii/behindmemo)

## æŠ€æœ¯æ ˆ

- Next.js 15.1.6
- React 19
- TypeScript 5
- Tailwind CSS
- Prisma ORM
- NextAuth.js
- Framer Motion
- MiniMax AI API
- Google OAuth 2.0
- Vercel Blob Storage
- Neon Serverless Postgres

## å¼€å§‹ä½¿ç”¨

1. å…‹éš†ä»“åº“

   ```bash
   git clone https://github.com/your-username/behindmemo.git
   ```

2. å¤åˆ¶ç¯å¢ƒå˜é‡æ–‡ä»¶

   ```bash
   cp .env.example .env
   ```

3. å®‰è£…ä¾èµ–

   ```bash
   npm install
   ```

4. å¯åŠ¨å¼€å‘æœåŠ¡å™¨
   ```bash
   npm run dev
   ```

## ç¯å¢ƒå˜é‡

- `BLOB_READ_WRITE_TOKEN`: Vercel Blob å­˜å‚¨ä»¤ç‰Œ
- `MINIMAX_API_KEY`: MiniMax API å¯†é’¥
- `GOOGLE_CLIENT_ID`: Google OAuth å®¢æˆ·ç«¯ ID
- `GOOGLE_CLIENT_SECRET`: Google OAuth å®¢æˆ·ç«¯å¯†é’¥
- `AUTH_SECRET`: NextAuth.js å¯†é’¥
- `DATABASE_URL`: Neon PostgreSQL æ•°æ®åº“è¿æ¥ URL
- `DIRECT_URL`: Neon PostgreSQL ç›´è¿ URLï¼ˆä¸ç»è¿‡è¿æ¥æ± ï¼‰

## éƒ¨ç½²

é¡¹ç›®é…ç½®ä¸ºä½¿ç”¨ Vercel è‡ªåŠ¨éƒ¨ç½²ï¼š

1. æ¨é€åˆ° main åˆ†æ”¯ä¼šè‡ªåŠ¨è§¦å‘éƒ¨ç½²
2. ç¯å¢ƒå˜é‡éœ€è¦åœ¨ Vercel é¡¹ç›®è®¾ç½®ä¸­é…ç½®
3. ç”Ÿäº§ç¯å¢ƒæ„å»ºä¼šè‡ªåŠ¨ä¼˜åŒ–æ€§èƒ½

## å¼€å‘è§„èŒƒ

- ä½¿ç”¨ ESLint è¿›è¡Œä»£ç è§„èŒƒæ£€æŸ¥
- éµå¾ª TypeScript ç±»å‹å®šä¹‰
- ç»„ä»¶ä½¿ç”¨ shadcn/ui é£æ ¼
- æ ·å¼é‡‡ç”¨ Tailwind CSS å®ç°
- ä½¿ç”¨ Turbopack åŠ é€Ÿå¼€å‘

## ç³»ç»Ÿè¦æ±‚

- Node.js >= 18.17
- npm >= 9.0.0

## è´¡çŒ®

æ¬¢è¿æäº¤ Pull Request æˆ–æå‡º Issueã€‚åœ¨æäº¤ä»£ç å‰ï¼Œè¯·ç¡®ä¿ï¼š

1. ä»£ç é€šè¿‡ ESLint æ£€æŸ¥
2. TypeScript ç±»å‹å®Œæ•´
3. æä¾›å¿…è¦çš„æµ‹è¯•
4. æ›´æ–°ç›¸å…³æ–‡æ¡£

## è®¸å¯

MIT License

## AI Love Letter Generator

åŸºäº Next.js å’Œ MiniMax API çš„ AI æƒ…ä¹¦ç”Ÿæˆå™¨ã€‚

## æŠ€æœ¯æ¶æ„

### 1. æ•°æ®æ¨¡å‹

```prisma
model Letter {
  id          String    @id @default(cuid())
  content     String    @db.Text
  imageUrl    String?
  userId      String
  prompt      String    @db.Text
  status      String    @default("pending")  // pending -> generating -> completed
  language    String    @default("zh")
  metadata    Json?     // å­˜å‚¨é¢å¤–ä¿¡æ¯
  user        User      @relation(fields: [userId], references: [id])
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}
```

### 2. API æ¥å£è®¾è®¡

#### åˆ›å»ºä¿¡ä»¶

- è·¯ç”±: `POST /api/letters`
- åŠŸèƒ½: åˆ›å»ºä¿¡ä»¶è®°å½•
- å‚æ•°:
  ```typescript
  {
    name: string
    loverName: string
    story: string
    imageUrl: string
    metadata?: object
  }
  ```
- è¿”å›: `{ id: string }`

#### ç”Ÿæˆå†…å®¹

- è·¯ç”±: `POST /api/letters/{id}/generate`
- åŠŸèƒ½: è°ƒç”¨ AI ç”Ÿæˆä¿¡ä»¶å†…å®¹
- è¿”å›: `{ letter: Letter }`

#### è·å–ä¿¡ä»¶

- è·¯ç”±: `GET /api/letters/{id}`
- åŠŸèƒ½: è·å–ä¿¡ä»¶è¯¦æƒ…
- è¿”å›: `{ letter: Letter }`

### 3. ä¸šåŠ¡æµç¨‹

1. å†™ä¿¡é¡µé¢ (`/write`)

   - è¡¨å•æ”¶é›†ç”¨æˆ·è¾“å…¥
   - ä¸Šä¼ å›¾ç‰‡è·å– URL
   - åˆ›å»ºä¿¡ä»¶è®°å½•
   - è·³è½¬åˆ°ç»“æœé¡µé¢

2. ç»“æœé¡µé¢ (`/result/[id]`)
   - è·å–ä¿¡ä»¶è¯¦æƒ…
   - å¦‚æœçŠ¶æ€æ˜¯ pendingï¼Œè‡ªåŠ¨å¼€å§‹ç”Ÿæˆ
   - å®æ—¶æ˜¾ç¤ºç”ŸæˆçŠ¶æ€
   - å®Œæˆåå±•ç¤ºå†…å®¹å’Œæ“ä½œæŒ‰é’®

### 4. ç»„ä»¶ç»“æ„

```
app/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ WritingForm.tsx      # å†™ä¿¡è¡¨å•ç»„ä»¶
â”‚   â””â”€â”€ ResultsPage.tsx      # ç»“æœé¡µé¢ç»„ä»¶
â”œâ”€â”€ write/
â”‚   â””â”€â”€ page.tsx             # å†™ä¿¡é¡µé¢
â””â”€â”€ result/
    â””â”€â”€ [id]/
        â””â”€â”€ page.tsx         # ç»“æœé¡µé¢
```

### 5. çŠ¶æ€ç®¡ç†

1. ä¿¡ä»¶çŠ¶æ€

   - `pending`: åˆå§‹çŠ¶æ€ï¼Œç­‰å¾…ç”Ÿæˆ
   - `generating`: æ­£åœ¨ç”Ÿæˆå†…å®¹
   - `completed`: ç”Ÿæˆå®Œæˆ

2. é¡µé¢çŠ¶æ€
   - åŠ è½½çŠ¶æ€
   - é”™è¯¯çŠ¶æ€
   - å›¾ç‰‡åŠ è½½çŠ¶æ€

### 6. é”™è¯¯å¤„ç†

1. API é”™è¯¯

   - 401: æœªæˆæƒ
   - 404: ä¿¡ä»¶ä¸å­˜åœ¨
   - 403: æ— æƒè®¿é—®
   - 500: æœåŠ¡å™¨é”™è¯¯

2. ç”¨æˆ·åé¦ˆ
   - åŠ è½½æŒ‡ç¤ºå™¨
   - é”™è¯¯æç¤º
   - çŠ¶æ€æ›´æ–°æç¤º

### 7. æ€§èƒ½ä¼˜åŒ–

1. å›¾ç‰‡å¤„ç†

   - ä½¿ç”¨ Next.js Image ç»„ä»¶
   - å›¾ç‰‡æ‡’åŠ è½½
   - æ¸è¿›å¼åŠ è½½æ•ˆæœ

2. çŠ¶æ€ç¼“å­˜
   - ä½¿ç”¨ localStorage å­˜å‚¨ä¸´æ—¶çŠ¶æ€
   - API å“åº”ç¼“å­˜

### 8. å®‰å…¨è€ƒè™‘

1. æƒé™éªŒè¯

   - ç”¨æˆ·è®¤è¯
   - èµ„æºè®¿é—®æ§åˆ¶
   - API è¯·æ±‚éªŒè¯

2. æ•°æ®éªŒè¯
   - è¾“å…¥éªŒè¯
   - æ–‡ä»¶ä¸Šä¼ é™åˆ¶
   - API å‚æ•°éªŒè¯

## å¼€å‘è§„èŒƒ

1. ç»„ä»¶è§„èŒƒ

   - ä½¿ç”¨ TypeScript ç±»å‹å®šä¹‰
   - éµå¾ª React Hooks è§„èŒƒ
   - ç»„ä»¶èŒè´£å•ä¸€

2. API è§„èŒƒ

   - RESTful è®¾è®¡
   - ç»Ÿä¸€é”™è¯¯å¤„ç†
   - è¯·æ±‚å‚æ•°éªŒè¯

3. ä»£ç é£æ ¼
   - ESLint + Prettier
   - ç»Ÿä¸€çš„å‘½åè§„èŒƒ
   - æ¸…æ™°çš„ä»£ç æ³¨é‡Š

## è‡ªåŠ¨åŒ–å·¥å…·ä¸æ–¹æ³•

### è‡ªåŠ¨åŒ–é”™è¯¯ä¿®å¤

1. æ„å»ºé”™è¯¯è‡ªåŠ¨ä¿®å¤

   - ä½¿ç”¨ `next lint --fix` è‡ªåŠ¨ä¿®å¤ ESLint é”™è¯¯
   - ä½¿ç”¨ `prettier --write .` è‡ªåŠ¨æ ¼å¼åŒ–ä»£ç 
   - ä½¿ç”¨ `tsc --noEmit` æ£€æŸ¥ç±»å‹é”™è¯¯
   - ç»„åˆå‘½ä»¤ï¼š
     ```bash
     npm run lint:fix && npm run format && npm run typecheck
     ```

2. æœªä½¿ç”¨å¯¼å…¥è‡ªåŠ¨æ¸…ç†

   - ä½¿ç”¨ `eslint-plugin-unused-imports` çš„è‡ªåŠ¨ä¿®å¤åŠŸèƒ½
   - é…ç½® VS Code è‡ªåŠ¨ä¿å­˜æ—¶æ‰§è¡Œ:
     ```json
     {
       "editor.codeActionsOnSave": {
         "source.removeUnusedImports": true,
         "source.fixAll.eslint": true
       }
     }
     ```

3. æ‰¹é‡ä¿®å¤è„šæœ¬

   ```json
   {
     "scripts": {
       "fix:all": "npm run lint:fix && npm run format && npm run typecheck",
       "fix:imports": "eslint --fix --rule 'unused-imports/no-unused-imports: error'",
       "fix:style": "prettier --write . && eslint --fix",
       "fix:types": "tsc --noEmit"
     }
   }
   ```

4. è‡ªåŠ¨ä¿®å¤å·¥ä½œæµ

   - ä¿å­˜æ—¶è‡ªåŠ¨ä¿®å¤
   - æäº¤å‰è‡ªåŠ¨ä¿®å¤
   - æ„å»ºå‰è‡ªåŠ¨ä¿®å¤
   - å®šæœŸæ‰¹é‡ä¿®å¤

5. VS Code é›†æˆ
   - å®‰è£… ESLint æ’ä»¶
   - å®‰è£… Prettier æ’ä»¶
   - é…ç½®è‡ªåŠ¨ä¿å­˜æ—¶ä¿®å¤
   - å¿«æ·é”®ç»‘å®šä¿®å¤å‘½ä»¤

## æ·»åŠ æ–°æ¨¡æ¿è¦é¢†æ€»ç»“

æ·»åŠ æ–°æ¨¡æ¿éœ€è¦åœ¨å››ä¸ªå…³é”®ä½ç½®è¿›è¡Œä¿®æ”¹ï¼Œç¡®ä¿æ¨¡æ¿åœ¨å„ä¸ªç¯å¢ƒä¸‹éƒ½èƒ½æ­£ç¡®æ˜¾ç¤ºã€‚ä»¥ä¸‹æ˜¯å®Œæ•´çš„æ­¥éª¤å’Œè¦ç‚¹ï¼š

#### 1. åœ¨ ResultsPage.tsx å®šä¹‰æ¨¡æ¿

åœ¨ `TEMPLATES` å¸¸é‡ä¸­æ·»åŠ æ–°æ¨¡æ¿çš„å®šä¹‰ï¼š

```typescript
const TEMPLATES = {
  // ç°æœ‰æ¨¡æ¿...
  // å½“å‰å·²æœ‰æ¨¡æ¿åŒ…æ‹¬: classic, postcard, magazine, artisan, natural, darkWine,
  // paperMemo, oceanBreeze, darkCrimson, purpleDream, elegantPaper, roseParchment

  myNewTemplate: {
    name: 'æ¨¡æ¿åç§°',
    style: {
      width: 1200, // æ¨èå®½åº¦1173-1200px
      padding: 60, // å†…è¾¹è·å¤§å°å½±å“å†…å®¹åŒºåŸŸ
      background: 'url(/images/my-bg.jpg) no-repeat center center / cover', // èƒŒæ™¯å¯ä½¿ç”¨å›¾ç‰‡æˆ–æ¸å˜è‰²
      titleFont: '"Source Serif Pro", serif', // æ ‡é¢˜å­—ä½“
      contentFont: '"Source Serif Pro", serif', // å†…å®¹å­—ä½“
    },
    isFree: false, // æ˜¯å¦ä¸ºå…è´¹æ¨¡æ¿ï¼Œtrueè¡¨ç¤ºå…è´¹ï¼Œfalseè¡¨ç¤ºéœ€è¦VIPæˆ–è§£é”
  },
}
```

#### 2. å®ç°æ¨¡æ¿HTMLç”Ÿæˆé€»è¾‘

åœ¨ `generateTemplateHtml` å‡½æ•°ä¸­æ·»åŠ æ¨¡æ¿çš„HTMLç»“æ„ï¼š

```typescript
case 'myNewTemplate':
  return `
    <div style="
      width: ${style.width}px;
      min-height: ${style.width * 0.75}px;
      padding: ${style.padding}px;
      background: ${style.background};
      position: relative;
      font-family: ${fontFamily};
      color: #é¢œè‰²ä»£ç ;           // æ ¹æ®èƒŒæ™¯é€‰æ‹©åˆé€‚çš„æ–‡å­—é¢œè‰²
      display: flex;
      flex-direction: column;
      box-shadow: 0 20px 40px rgba(0,0,0,0.2);
      border-radius: 12px;
      overflow: hidden;
    ">
      ${/* å›¾ç‰‡åŒºåŸŸ */}
      ${letter.imageUrl ? `
        <div style="
          margin: 20px 0 40px;
          border-radius: 8px;
          overflow: hidden;
          box-shadow: 0 8px 24px rgba(0,0,0,0.2);
        ">
          <img
            src="${letter.imageUrl}"
            style="
              width: 100%;
              height: auto;
              display: block;
            "
            crossorigin="anonymous"
          />
        </div>
      ` : ''}

      ${/* æ–‡å­—åŒºåŸŸ */}
      <div style="
        font-size: 22px;
        line-height: 1.8;
        color: #é¢œè‰²ä»£ç ;
        text-align: justify;
        padding: 30px;
        background: rgba(255,255,255,0.9);  // æ ¹æ®è®¾è®¡è°ƒæ•´èƒŒæ™¯è‰²å’Œé€æ˜åº¦
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      ">
        ${letter.content?.split('\n').filter(p => p.trim()).join('<br><br>')}
      </div>

      ${/* æ°´å°åŒºåŸŸ - æ ¹æ®èƒŒæ™¯è‰²é€‰æ‹© */}
      <div style="
        margin-top: 30px;
        text-align: center;
        font-size: 16px;
        color: #é¢œè‰²ä»£ç ;        // æ°´å°æ–‡å­—é¢œè‰²
        font-style: italic;
        height: 35px;
        display: flex;
        justify-content: center;
      ">
        ${getWatermarkHTML('light')}  // æµ…è‰²èƒŒæ™¯ç”¨lightï¼Œæ·±è‰²èƒŒæ™¯ç”¨dark
      </div>
    </div>
  `;
```

#### 3. åœ¨ StyleDrawer æ·»åŠ æ¨¡æ¿é¢„è§ˆ

åœ¨ `StyleDrawer.tsx` ä¸­ä¿®æ”¹å¤šå¤„ä»£ç ä»¥æ”¯æŒæ–°æ¨¡æ¿çš„é¢„è§ˆæ˜¾ç¤ºï¼š

```typescript
// 1. æ¨¡æ¿å¡ç‰‡èƒŒæ™¯ - ä½¿ç”¨é¢œè‰²æ¸å˜æˆ–èƒŒæ™¯å›¾
key === 'myNewTemplate' && "overflow-hidden", // ä½¿ç”¨èƒŒæ™¯å›¾æ—¶è®¾ç½®overflow-hidden

// 2. å¦‚æœä½¿ç”¨èƒŒæ™¯å›¾ï¼Œæ·»åŠ èƒŒæ™¯å›¾å±‚
{key === 'myNewTemplate' && (
  <>
    <div className="absolute inset-0 bg-cover bg-center"
         style={{ backgroundImage: 'url(/images/my-bg.jpg)' }}></div>
    <div className="absolute inset-0 bg-black/10"></div> // æ·»åŠ è½»å¾®é®ç½©æé«˜æ–‡å­—å¯è§åº¦
  </>
)}

// 3. å†…å®¹å®¹å™¨æ ·å¼
key === 'myNewTemplate'
  ? "border-white/20" // å¸¦èƒŒæ™¯å›¾çš„æ¨¡æ¿ä½¿ç”¨ç®€å•è¾¹æ¡†
  : "border-black/10 bg-white/90"

// 4. æ–‡å­—éƒ¨åˆ†é¢„è§ˆ
// æ ¹æ®æ¨¡æ¿ç‰¹ç‚¹å†³å®šæ˜¯ä½¿ç”¨æ™®é€šæ–‡æœ¬çº¿æ¡è¿˜æ˜¯ç‰¹æ®Šå¸ƒå±€
{key === 'myNewTemplate' ? (
  <div className="w-full h-full flex flex-col justify-center items-center relative">
    {/* å¯ä»¥æ·»åŠ ç‰¹æ®Šè¾¹æ¡†æˆ–æ•ˆæœ */}
    <div className="absolute inset-2 border-2 border-[#é¢œè‰²ä»£ç ]/30 rounded-sm"></div>
    {/* æ·»åŠ 3-4è¡Œæ–‡æœ¬çº¿æ¡ */}
    <div className="w-[70%] h-[2px] rounded-full my-[3px] bg-[#é¢œè‰²ä»£ç ]" />
    <div className="w-[60%] h-[2px] rounded-full my-[3px] bg-[#é¢œè‰²ä»£ç ]" />
    <div className="w-[80%] h-[2px] rounded-full my-[3px] bg-[#é¢œè‰²ä»£ç ]" />
  </div>
) : null}
```

#### 4. æ›´æ–°ç»“æœé¡µé¢æ¸²æŸ“

ç¡®ä¿ `ResultsPage.tsx` ä¸­çš„å®æ—¶é¢„è§ˆéƒ¨åˆ†ä¹Ÿæ”¯æŒæ–°æ¨¡æ¿ï¼š

```typescript
// é¡µé¢çº§èƒŒæ™¯é€‚é…
<div className={cn(
  "min-h-screen overflow-x-hidden",
  selectedTemplate === 'myNewTemplate'
    ? "bg-[url('/images/my-bg.jpg')] bg-cover bg-center bg-fixed"
    : // å…¶ä»–æ¨¡æ¿çš„èƒŒæ™¯
)}>

// ä¿¡ä»¶å®¹å™¨é€‚é…
<div className={cn(
  "backdrop-blur-lg rounded-2xl p-8 md:p-10 shadow-2xl border transition-all duration-500",
  selectedTemplate === 'myNewTemplate'
    ? "bg-[#é¢œè‰²ä»£ç ]/80 border-[#é¢œè‰²ä»£ç ]/10"
    : "bg-white/90 border-black/5"
)}>
```

#### 5. å½“å‰å¯ç”¨æ¨¡æ¿åˆ—è¡¨

ç›®å‰ç³»ç»Ÿå·²å®ç°ä»¥ä¸‹æ¨¡æ¿ï¼Œå¯ä½œä¸ºæ–°æ¨¡æ¿å¼€å‘çš„å‚è€ƒï¼š

1. **classic**: Classic Dark - æ·±è‰²ç»å…¸æ¨¡æ¿ï¼Œå…è´¹
2. **postcard**: Postcard - æ˜ä¿¡ç‰‡é£æ ¼æ¨¡æ¿ï¼Œå…è´¹
3. **magazine**: Magazine - æ‚å¿—é£æ ¼æ¨¡æ¿ï¼Œå…è´¹
4. **artisan**: Artisan Red - çº¢è‰²å·¥åŒ é£æ ¼ï¼Œéœ€VIP
5. **natural**: Natural Parchment - è‡ªç„¶ç¾Šçš®çº¸é£æ ¼ï¼Œéœ€VIP
6. **darkWine**: Dark Wine - æ·±çº¢é…’è‰²é£æ ¼ï¼Œéœ€VIP
7. **paperMemo**: Paper Memoir - çº¸è´¨è®°å¿†é£æ ¼ï¼Œéœ€VIP
8. **oceanBreeze**: Ocean Breeze - æµ·æ´‹å¾®é£é£æ ¼ï¼Œéœ€VIP
9. **darkCrimson**: Dark Crimson - æ·±çº¢è‰²é£æ ¼ï¼Œéœ€VIP
10. **purpleDream**: Purple Dream - ç´«è‰²æ¢¦å¢ƒé£æ ¼ï¼Œéœ€VIP
11. **elegantPaper**: Elegant Paper - ä¼˜é›…çº¸å¼ é£æ ¼ï¼Œéœ€VIP
12. **roseParchment**: Rose Parchment - ç«ç‘°ç¾Šçš®çº¸é£æ ¼ï¼Œéœ€VIP

#### 6. æ³¨æ„äº‹é¡¹å’Œæœ€ä½³å®è·µ

1. **æ°´å°é€‰æ‹©**:

   - æµ…è‰²èƒŒæ™¯æ¨¡æ¿ï¼ˆå¦‚Postcardã€Magazineï¼‰ä½¿ç”¨æµ…è‰²æ°´å°ï¼ˆ`watermark-light.svg`ï¼‰
   - æ·±è‰²èƒŒæ™¯æ¨¡æ¿ï¼ˆå¦‚Classic Darkã€Dark Wineï¼‰ä½¿ç”¨æ·±è‰²æ°´å°ï¼ˆ`watermark-dark.svg`ï¼‰

2. **èƒŒæ™¯å›¾ç‰‡**:

   - èƒŒæ™¯å›¾å°ºå¯¸å»ºè®®ä¸º1200Ã—1600pxæˆ–æ›´å¤§ï¼Œä»¥é€‚åº”ä¸åŒå±å¹•
   - ä¼˜åŒ–å›¾ç‰‡æ–‡ä»¶å¤§å°ï¼Œä¿æŒè´¨é‡çš„åŒæ—¶å‡å°‘åŠ è½½æ—¶é—´
   - å›¾ç‰‡æ”¾ç½®äº`/public/images/`ç›®å½•ä¸‹

3. **æ–‡å­—å’Œå›¾ç‰‡åŒºåŸŸ**:

   - æ–‡å­—åŒºåŸŸåº”æœ‰è¶³å¤Ÿçš„å¯¹æ¯”åº¦ï¼Œç¡®ä¿å¯è¯»æ€§
   - ä¸ºå›¾ç‰‡åŒºåŸŸæ·»åŠ é€‚å½“çš„é˜´å½±å’Œåœ†è§’ï¼Œæå‡è§†è§‰æ•ˆæœ
   - æ ¹æ®å†…å®¹ç±»å‹ï¼ˆæƒ…ä¹¦ã€æ˜ä¿¡ç‰‡ç­‰ï¼‰è°ƒæ•´å¸ƒå±€å’Œé—´è·

4. **å“åº”å¼è€ƒè™‘**:
   - æ¨¡æ¿è®¾è®¡åº”è€ƒè™‘åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šçš„æ˜¾ç¤ºæ•ˆæœ
   - å­—ä½“å¤§å°å’Œè¡Œé«˜åº”é€‚åˆé•¿æ–‡æœ¬é˜…è¯»
